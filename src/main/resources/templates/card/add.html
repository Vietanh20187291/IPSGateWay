<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>


    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js" type="text/javascript"></script>
    <script th:src="@{/js/action.js}" type="text/javascript"></script>
    <script th:src="@{/js/bootstrap.min.js}" type="text/javascript"></script>

    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
    <title>Card</title>
</head>

<body>
<!-- Header -->
<!-- End Header -->

<!-- Body -->

<div class="container pt-1">
    <div id="wp-content">
        <div id="list-card-component">
            <h4>Add Card</h4>
            <form action="#" class="needs-validation"
                  novalidate
                  th:action="@{/cards/add}"
                  th:method="post"
                  th:object="${card}">
                <div id="list-card">
                    <table class="table table-bordered">
                        <thead class="table-header thead-light">
                        <tr>
                            <th class="col-md-1">Field ID</th>
                            <th class="col-md-1">Name</th>
                            <th class="col-md-2">Description</th>
                            <th>Value</th>
                            <th class="col-md-1"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="table-row">
                        <tr th:each="field, itemStat : *{listField}">
                            <!--                            Required Row-->
                            <div th:if="*{not listField[__${itemStat.index}__].optional}">
                                <td class="col-md-1 text-danger" th:text="${field.fieldId}+'*'"></td>
                                <td class="col-md-1" th:text="${field.name}"></td>
                                <td class="col-md-2" th:text="${field.description}"></td>
                                <td>
                                    <input class="border-0 form-control" readonly
                                           th:field="*{listField[__${itemStat.index}__].fieldId}"
                                           type="hidden"/>
                                    <!--                                    This hidden input is to set the fieldId to modelattribute-->
                                    <div>
                                        <input class="form-control border-0 input-value"
                                               required
                                               th:field="*{listField[__${itemStat.index}__].value}"
                                               th:id="${field.fieldId}"
                                               th:placeholder="'ex: '+*{listField[__${itemStat.index}__].value}"

                                               type="text">
                                        <div class="invalid-feedback">
                                            This cannot be empty!
                                        </div>
                                    </div>

                                </td>
                                <td th:id="${field.fieldId}+'-subfields'">
                                </td>
                            </div>
                            <!--                           End Required Row-->
                            <!--                          Optional row-->
                            <div th:if="*{listField[__${itemStat.index}__].optional}">
                                <td class="col-md-1" th:text="${field.fieldId}"></td>
                                <td class="col-md-1" th:utext="*{listField[__${itemStat.index}__].name}"></td>
                                <td class="col-md-2" th:utext="*{listField[__${itemStat.index}__].description}"></td>
                                <td>
                                    <input readonly th:field="*{listField[__${itemStat.index}__].fieldId}"
                                           type="hidden"/>
                                    <!-- This hidden input is to set the fieldId to modelattribute-->
                                    <div>
                                        <input class="form-control border-0 input-value"
                                               th:field="*{listField[__${itemStat.index}__].value}"
                                               th:id="${field.fieldId}"
                                               th:placeholder="'ex: '+*{listField[__${itemStat.index}__].value}"
                                               type="text">
                                    </div>
                                </td>
                                <td></td>
                            </div>
                        </tr>
                        <!--                        End Optional Row-->
                        </tbody>
                    </table>

                    <div>
                        <button class="btn btn-outline-secondary float-right m-1">
                            <a class="text-secondary" th:href="@{/cards}">BACK</a>
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-outline-secondary float-right m-1">
                            SAVE
                        </button>
                    </div>
                    <!-- Modal -->
                    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="notificationId"
                         role="dialog" tabindex="-1">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title text-danger" id="exampleModalLabel">Notification</h5>
                                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    Please Fill All Required Fields
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal -->
                    <div aria-hidden="true" aria-labelledby="exampleModalLabel1" class="modal fade" id="subfieldsId"
                         role="dialog" tabindex="-1">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel1">Subfields</h5>
                                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body" id="subfields-body">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </form>


        </div>
    </div>
</div>
<!-- End WP-Content -->

</div>
<!-- End Body -->

</body>
<script th:src="@{/js/card.js}" type="text/javascript"></script>
<!--<script>-->
<!--    var list = document.getElementsByClassName('input-value');-->
<!--    var n;-->
<!--    for (n = 0; n < list.length; ++n) {-->
<!--        list[n].value='';-->
<!--    }-->

<!--</script>-->

<style>
    .form-control:focus {
        box-shadow: none;
    }

    .form-control {
        background-color: white !important;
    }
</style>
<script>
    //Set parameter to subfields body
    var f45 = [
        {
            id: 'F45.01',
            name: 'Track 1 Format Code (F45.01) '
        },
        {
            id: 'F45.02',
            name: 'Primary Account Number (F45.02)'
        },
        {
            id: 'F45.03',
            name: 'Card Holder Name (F45.03)'
        },
        {
            id: 'F45.04',
            name: 'Expiration Date (F45.04)'
        }
        ,
        {
            id: 'F45.05',
            name: 'Service Code (F45.05)'
        }
        ,
        {
            id: 'F45.06',
            name: 'PKI Number (F45.06)'
        }
        ,
        {
            id: 'F45.07',
            name: 'Discretionary Data (F45.07)'
        }


    ]
    var box = ''
    f45.map((subfield_info) => {
        box = box + `<div className="${subfield_info.id}">
        <label htmlFor="${subfield_info.id}">${subfield_info.name} :</label>
        <input class="form-control required-field-45" id="${subfield_info.id}" name="${subfield_info.id}" type="text">
        </div>`
    })

    const subfields_body= box + ` <br>
                                        <div class="form-group">
                                            <button id="submit-f45" aria-label="Close" class="btn btn-primary" data-dismiss="modal" type="button">
                                                Submit
                                            </button>
                                        </div>`;

    document.getElementById('subfields-body').innerHTML = subfields_body;

    var button_subfields_f45 = `<button class="btn btn-outline-secondary float-right m-1" onclick="openSubFieldsF45()"
                                          type="button">SubFields
                                    </button>`

    document.getElementById('F045-subfields').innerHTML = button_subfields_f45;
    //Set parameter to subfields body
    function openSubFieldsF45() {
        jQuery.noConflict();
        window.$('#subfieldsId').modal('show');
    }

    $("#submit-f45").on("click", function (e) {
        console.log('submit')
        var forms = document.querySelectorAll(".required-field-45")
        console.log(forms.length)
        var validForm = 0
        // wait until 5 forms are valid to submit data
        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.classList.remove('border-danger')
                if (form.value == '') {
                    event.preventDefault()
                    event.stopPropagation()
                    form.classList.add('border-danger')
                } else {
                    validForm++
                }
                if (validForm == 7) {
                    var f45_01 = document.getElementById('F45.01').value;
                    var f45_02 = document.getElementById('F45.02').value;
                    var f45_03 = document.getElementById('F45.03').value;
                    var f45_04 = document.getElementById('F45.04').value;
                    var f45_05 = document.getElementById('F45.05').value;
                    var f45_06 = document.getElementById('F45.06').value;
                    var f45_07 = document.getElementById('F45.07').value;
                    var f45 = f45_01 + f45_02 + '^' + f45_03 + '^' + f45_04 + f45_05 + f45_06 + f45_07;
                    document.getElementById("F045").value = f45;
                }

            })


    });

    (function () {
        'use strict'

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                        jQuery.noConflict();
                        window.$('#notificationId').modal('show');
                    }
                    form.classList.add('was-validated')

                }, false)
            })
    })()
</script>
<link rel="stylesheet" th:href="@{/css/card.css}"/>
</html>